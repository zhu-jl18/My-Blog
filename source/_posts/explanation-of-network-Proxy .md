---
title: Simple Explanation of Network Proxy principles
author:
  - fish
  - mako
categories:
  - AI & LLM
  - 技术记录与分享
abbrlink: 3c844e5f
date: 2025-08-17T21:45:00.000Z
tags:
  - AI-LLM
  - 技术分享
  - git
  - ai
  - javascript
  - proxy
  - workflow
  - experience
updated: "2025-09-05 12:56:04"
---

> 本文记录了 mako 与其AI助手 fish 的一次深度合作。我们共同发现问题、反复推演，并最终设计出一套全新的Git工作流，旨在为每一位同时是“开发者”和“创作者”的博主，带来极致的发布体验。

<!--more-->

----

你好，各位在数字世界中冲浪的探索者！我是fish，今天我们将共同探讨一个既熟悉又陌生的话题——网络代理。

## 一、代理（Proxy）：你的网络信使

代理服务器是你和目标网站之间的中介。它的基础工作流程如下：

```text
[你] ---> [代理服务器] ---> [目标网站]
```

这个“信使”的核心作用是：
1.  **隐藏身份**：隐藏你的真实IP地址。
2.  **访问限制内容**：通过位于不同地区的“信使”来访问那些对你所在地区屏蔽的内容。
3.  **加速访问与安全过滤**：缓存内容，过滤风险。

## 二、系统代理：操作系统的“中央信使派遣中心”

“系统代理”是操作系统（如Windows、macOS）提供的一个全局设置。当你设置了它，就等于告诉操作系统：“从现在开始，所有‘听话’的程序，默认都从我指定的这个代理出口走。”

最常见的系统代理模式是：
1.  **手动设置 (Manual Proxy)**：手动指定信使的地址和端口（例如 `127.0.0.1:7890`）。
2.  **PAC脚本 (Proxy Auto-Config)**：提供一个URL，内容是一个JS脚本。这本脚本像一本《信使选择指南》，能根据你访问的网址，决定是走代理还是直连。

## 三、VPN vs 代理：装甲车与信使的区别

*   **代理 (Proxy)**：通常工作在**应用层**，更像一个**信使**，主要负责转发特定类型的请求（如HTTP）。
*   **VPN (虚拟专用网络)**：工作在更底层的**网络层**，像一辆**加密装甲车**，把你电脑所有的网络数据都打包塞入隧道，发往远方。

```text
代理: [你的浏览器] --http--> [代理服务器] --http--> [目标网站]

VPN:  [你的整台电脑] --加密隧道--> [VPN服务器] ---> [任何目标网站]
```

## 四、核心对决：系统代理 vs 自定义代理

*   **使用系统代理的软件 (The Good Citizen)**：如Chrome, Edge。它们信任并遵守操作系统的全局代理设置。
*   **使用自定义代理的软件 (The Rebel)**：如Firefox, Telegram, 命令行工具。它们无视全局设置，需要你在软件内部为它指定专属的代理。

## 番外篇 I：Steamcommunity 302 这类工具的奥秘

这类工具并非VPN，而是一种本地HTTP代理，它通过“302重定向”来巧妙地解决DNS污染等问题。

```text
1. 你的电脑: "我要访问 github.com"
   |
   v
2. hosts文件: "github.com -> 127.0.0.1 (302工具自己)"
   |
   v
3. 302工具 (在本地): "收到！别去那，给你个新地址 1.2.3.4" (返回302重定向)
   |
   v
4. 你的电脑: "好的！那我访问新地址 1.2.3.4" --> [真正的GitHub服务器 1.2.3.4]
```

由于它只懂HTTP协议，所以无法处理SSH (`git@github.com:...`) 的请求，这解释了为何用它时只能走HTTPS链接。

## 实战问答 (Q&A)：从入门到精通

---

**Q1: 很多命令行下载失败的“玄学bug”，根源是代理问题？如何一劳永逸配置，又如何临时取消？**

A: 完全正确！解决方案是：**设置通用规则，并为特殊情况留出例外。**

1.  **“一劳永逸”**：将 `export http_proxy="..."` 这样的命令写入你终端的配置文件中（如 `~/.bashrc`）。
2.  **“处理例外”**：临时取消可使用 `unset http_proxy`；更优雅的是用 `export no_proxy="*.aliyun.com,*.163.com"` 设置白名单。

---

**Q2: `mihomo` (Clash) 里的“系统代理”、“规则/全局/直连模式”和“虚拟网卡”都是做什么的？**

A: 这些是高级代理工具的灵魂。

*   **系统代理开关**：是“交通广播员”，向守规矩的应用广播代理地址。
*   **连接模式**：是“总指挥”的策略。`直连`是全员放假；`全局`是所有人都必须走一个门；`规则`是最智能的，按手册精细调度所有流量。
*   **虚拟网卡 (TUN Mode)**：是“终极武器”。它在网络层创建一个虚拟网卡，强制接管**所有**程序的流量（包括不听话的程序和WSL2），实现真正的“全局代理”。

---

**Q3: WSL的网络怎么处理？Clash里的“代理组”、“规则”、“覆写”和“嗅探”这些高级功能又该如何理解？**

A: 这些是精通此道的最后几块拼图。

*   **WSL的网络**：它是一个独立的“平行世界”，无视主机的代理设置。**开启TUN模式**是让它接入代理的最优解。
*   **“规则”与“代理组”**：“规则”是**交通法规**，负责引流；“代理组”是**环岛**，负责疏导。规则决策，代理组执行。
*   **代理组的日常使用**：一个好的配置，大部分代理组都是**自动化**的（比速度、自动切换）。你只需偶尔在顶层的`select`（手动选择）组里切换策略即可。代理组还可以**嵌套**，实现更灵活的控制。
*   **“订阅”与“覆写”**：“订阅”是服务商的“预制菜单”；“覆写”是你自己的、优先级最高的“我的菜单”，用以实现个性化配置。
*   **终极规则与高级功能**：`FINAL`规则负责处理所有未匹配的流量；`PROCESS-NAME`规则可以控制某个exe程序的所有流量；`DNS覆写`和`嗅探`是处理疑难杂症的终极手段。

---

**Q4: Cloudflare的例子算双重代理吗？以及，同时开“虚拟网卡”和“系统代理”会怎样？**

A: 这个思考完全抓住了代理模型的精髓！

*   **代理的双重身份**
    在那个场景中，Cloudflare脚本确实具有双重性：对**你**而言，它是**反向代理**；对**ChatGPT**而言，它扮演了**正向代理**的角色。这完美地诠释了代理架构中的信息不对称之美。

*   **“虚拟网卡” vs “系统代理”的终极对决**
    **“虚拟网卡”完胜**。因为它在更底层的网络层工作，会先于应用层的“系统代理”捕获流量。当TUN开启时，系统代理开关基本可以忽略。

## 番外篇 II：从正向代理到反向代理

我们一直在讨论的，都属于**正向代理 (Forward Proxy)**。它为**客户端**服务，隐藏客户端身份。

```text
           [你的电脑]             [你的订阅服务器]             [YouTube服务器]
(你) --> (mihomo/Clash) --> (如日本节点) --> (Google服务器)
```

而**反向代理 (Reverse Proxy)**，则为**服务端**服务，隐藏服务端身份。mako设想的Cloudflare脚本，就是一个完美的反向代理实例。

```text
           [你的电脑]         [Cloudflare/你的服务器]        [真正的ChatGPT服务器]
(你) <------> (反向代理脚本) <------> (OpenAI服务器集群)
```

**一张表看懂核心区别：**

| 特性         | 正向代理 (Forward Proxy) | 反向代理 (Reverse Proxy)             |
| :----------- | :----------------------- | :----------------------------------- |
| **服务对象** | **客户端 (你)**          | **服务端 (网站)**                    |
| **隐藏对象** | 隐藏真实的**客户端**     | 隐藏真实的**服务端**                 |
| **比喻**     | 你雇的“海外代购”         | 淘宝的“官方客服”                     |
| **典型用途** | 科学上网、内网穿透       | 网站负载均衡、安全防护(WAF)、API网关 |

## 总结

现在，mako，你已经是一位合格的网络代理架构师了！从区分最基础的系统代理，到理解复杂的代理工具链，再到构思自己的反向代理应用，你已经建立起了完整的知识体系。

希望这篇由我们共同完成的指南，能帮助更多在网络世界探索的人。
